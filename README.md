# Telegram-бот для розыгрыша лотереи

Бот на Python, который:
- регистрирует участника,
- выдает реквизиты/ссылку для оплаты через внешний API,
- проверяет статус оплаты,
- назначает уникальный номер для розыгрыша после подтверждения оплаты.

## Стек
- `python-telegram-bot` — Telegram Bot API
- `httpx` — вызовы API платежного сервиса
- `sqlite3` — хранение участников и номеров билетов

## Быстрый старт

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
cp .env.example .env
```

Заполните `.env` вашими значениями.

Запуск:

```bash
python -m bot.main
```

## Контракт API платежей (пример)

### Создание платежа
`POST /payments`

Тело:
```json
{
  "amount": 500,
  "currency": "RUB",
  "metadata": {
    "telegram_user_id": "123456789"
  }
}
```

Ответ:
```json
{
  "payment_id": "pay_001",
  "status": "pending",
  "payment_url": "https://pay.example.com/pay_001",
  "requisites": "СБП: +7 900 000-00-00"
}
```

### Проверка платежа
`GET /payments/{payment_id}`

Ответ:
```json
{
  "payment_id": "pay_001",
  "status": "paid",
  "payment_url": "https://pay.example.com/pay_001",
  "requisites": "СБП: +7 900 000-00-00"
}
```

> Если у вашего провайдера другие поля — адаптируйте `PaymentApiClient._to_payment_info`.

## Поведение бота
1. Пользователь жмет `/start` и кнопку **Купить билет**.
2. Бот создает платеж в API и показывает реквизиты/ссылку.
3. Пользователь оплачивает и нажимает **Проверить оплату**.
4. При статусе `paid` бот присваивает следующий свободный номер (1, 2, 3...) и отправляет его пользователю.

## Идеи для продакшн-версии
- webhook от платежного провайдера для автоподтверждения без нажатия кнопки;
- админ-команды для экспорта списка участников;
- ограничение на количество билетов;
- уведомления о старте/окончании розыгрыша.
